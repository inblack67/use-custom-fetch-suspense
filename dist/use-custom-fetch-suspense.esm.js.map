{"version":3,"file":"use-custom-fetch-suspense.esm.js","sources":["../src/index.ts"],"sourcesContent":["import produce from 'immer';\nimport lru from 'lru-cache';\nimport md5 from 'md5';\n\nconst cache = new lru(50);\n\nexport default (url: string, options: object={}) => {\n    const key = `${url}.${md5(JSON.stringify(options))}`;\n\n    const value: any = cache.get(key) || { status: 'new', data: null }\n\n    if(value.status === 'resolved'){\n        return value.data;\n    }\n\n    const promise = fetch(url, options).then(res => res.json());\n\n    promise.then(data => {\n        cache.set(key, produce(value, (draft: any) => {\n            draft.status = 'resolved';\n            draft.data = data;\n        }));\n    })\n\n    throw promise; // will be caught by suspense\n}"],"names":["cache","lru","url","options","key","md5","JSON","stringify","value","get","status","data","promise","fetch","then","res","json","set","produce","draft"],"mappings":";;;;AAIA,IAAMA,KAAK,gBAAG,IAAIC,GAAJ,CAAQ,EAAR,CAAd;AAEA,aAAe,UAACC,GAAD,EAAcC,OAAd;MAAcA;AAAAA,IAAAA,UAAgB;;;AACzC,MAAMC,GAAG,GAAMF,GAAN,SAAaG,GAAG,CAACC,IAAI,CAACC,SAAL,CAAeJ,OAAf,CAAD,CAAzB;AAEA,MAAMK,KAAK,GAAQR,KAAK,CAACS,GAAN,CAAUL,GAAV,KAAkB;AAAEM,IAAAA,MAAM,EAAE,KAAV;AAAiBC,IAAAA,IAAI,EAAE;AAAvB,GAArC;;AAEA,MAAGH,KAAK,CAACE,MAAN,KAAiB,UAApB,EAA+B;AAC3B,WAAOF,KAAK,CAACG,IAAb;AACH;;AAED,MAAMC,OAAO,GAAGC,KAAK,CAACX,GAAD,EAAMC,OAAN,CAAL,CAAoBW,IAApB,CAAyB,UAAAC,GAAG;AAAA,WAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,GAA5B,CAAhB;AAEAJ,EAAAA,OAAO,CAACE,IAAR,CAAa,UAAAH,IAAI;AACbX,IAAAA,KAAK,CAACiB,GAAN,CAAUb,GAAV,EAAec,OAAO,CAACV,KAAD,EAAQ,UAACW,KAAD;AAC1BA,MAAAA,KAAK,CAACT,MAAN,GAAe,UAAf;AACAS,MAAAA,KAAK,CAACR,IAAN,GAAaA,IAAb;AACH,KAHqB,CAAtB;AAIH,GALD;AAOA,QAAMC,OAAN;AACH,CAnBD;;;;"}