{"version":3,"file":"use-custom-fetch-suspense.cjs.development.js","sources":["../src/fetchRoutes.ts","../src/index.ts"],"sourcesContent":["export default (url: RequestInfo, options: RequestInit | undefined) => {\n    return fetch(url, options).then(res => res.json());\n}","import produce from 'immer';\nimport lru from 'lru-cache';\nimport md5 from 'md5';\nimport fetchRoutes from './fetchRoutes'\n\nconst cache = new lru(50);\n\nexport default (url: string, options: object={}) => {\n    const key = `${url}.${md5(JSON.stringify(options))}`;\n\n    const value: any = cache.get(key) || { status: 'new', data: null }\n\n    if(value.status === 'resolved'){\n        return value.data;\n    }\n\n    const promise = fetchRoutes(url, options);\n\n    promise.then(data => {\n        cache.set(key, produce(value, (draft: any) => {\n            draft.status = 'resolved';\n            draft.data = data;\n        }));\n    })\n\n    throw promise; // will be caught by suspense\n}"],"names":["url","options","fetch","then","res","json","cache","lru","key","md5","JSON","stringify","value","get","status","data","promise","fetchRoutes","set","produce","draft"],"mappings":";;;;;;;;;;AAAA,mBAAe,UAACA,GAAD,EAAmBC,OAAnB;AACX,SAAOC,KAAK,CAACF,GAAD,EAAMC,OAAN,CAAL,CAAoBE,IAApB,CAAyB,UAAAC,GAAG;AAAA,WAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,GAA5B,CAAP;AACH,CAFD;;ACKA,IAAMC,KAAK,gBAAG,IAAIC,GAAJ,CAAQ,EAAR,CAAd;AAEA,aAAe,UAACP,GAAD,EAAcC,OAAd;MAAcA;AAAAA,IAAAA,UAAgB;;;AACzC,MAAMO,GAAG,GAAMR,GAAN,SAAaS,GAAG,CAACC,IAAI,CAACC,SAAL,CAAeV,OAAf,CAAD,CAAzB;AAEA,MAAMW,KAAK,GAAQN,KAAK,CAACO,GAAN,CAAUL,GAAV,KAAkB;AAAEM,IAAAA,MAAM,EAAE,KAAV;AAAiBC,IAAAA,IAAI,EAAE;AAAvB,GAArC;;AAEA,MAAGH,KAAK,CAACE,MAAN,KAAiB,UAApB,EAA+B;AAC3B,WAAOF,KAAK,CAACG,IAAb;AACH;;AAED,MAAMC,OAAO,GAAGC,WAAW,CAACjB,GAAD,EAAMC,OAAN,CAA3B;AAEAe,EAAAA,OAAO,CAACb,IAAR,CAAa,UAAAY,IAAI;AACbT,IAAAA,KAAK,CAACY,GAAN,CAAUV,GAAV,EAAeW,OAAO,CAACP,KAAD,EAAQ,UAACQ,KAAD;AAC1BA,MAAAA,KAAK,CAACN,MAAN,GAAe,UAAf;AACAM,MAAAA,KAAK,CAACL,IAAN,GAAaA,IAAb;AACH,KAHqB,CAAtB;AAIH,GALD;AAOA,QAAMC,OAAN;AACH,CAnBD;;;;"}